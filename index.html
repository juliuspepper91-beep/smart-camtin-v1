<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üì∏ Smart Camtin ‚Äî Firebase Auth + Filters</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --primary:#0078d7; --primary-dark:#005fa3; --bg:#111; --card:rgba(255,255,255,0.04);
    }
    *{box-sizing:border-box}
    body{font-family:"Poppins",sans-serif;margin:0;background:linear-gradient(180deg,#151515,#2b2b2b);color:#fff;min-height:100vh}
    nav{position:fixed;left:0;right:0;top:0;display:flex;justify-content:space-between;align-items:center;padding:12px 20px;background:rgba(0,0,0,0.45);backdrop-filter:blur(6px);z-index:50}
    nav h1{margin:0;font-size:18px;display:flex;gap:8px;align-items:center}
    .nav-right{display:flex;align-items:center;gap:10px}
    .btn{background:var(--primary);border:none;padding:8px 12px;border-radius:8px;color:#fff;cursor:pointer;transition:0.2s}
    .btn:hover{background:var(--primary-dark)}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.08)}
    main{margin-top:80px;display:flex;flex-direction:column;align-items:center;padding:28px}
    .card{background:var(--card);padding:18px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.6);max-width:980px;width:100%}
    .auth-wrap{display:flex;gap:20px;flex-wrap:wrap;justify-content:center}
    .auth-box{width:300px;padding:16px;border-radius:10px;background:rgba(255,255,255,0.02)}
    input{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid rgba(255,255,255,0.07);background:transparent;color:#fff}
    label{display:block;text-align:left;font-size:13px;margin-top:6px;opacity:0.9}
    /* camera */
    .camera-container{display:flex;flex-direction:column;align-items:center;gap:12px;margin-top:18px}
    video,canvas{width:480px;height:360px;border-radius:12px;background:#000;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
    #controls{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:12px}
    .small{font-size:13px;opacity:0.85}
    footer{margin-top:22px;text-align:center;opacity:0.6}
    @media(max-width:600px){video,canvas{width:320px;height:240px}}

    /* new filter buttons */
    .filter-buttons{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-top:10px}
    .filter-btn{padding:6px 10px;border-radius:6px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.05);color:#fff;cursor:pointer;font-size:13px;transition:0.2s}
    .filter-btn:hover{background:var(--primary-dark)}
    .filter-btn.active{background:var(--primary);border-color:var(--primary-dark)}
  </style>
</head>
<body>

<nav>
  <h1>üì∏ Smart Camtin</h1>
  <div class="nav-right">
    <div id="user-area" style="display:none;align-items:center;">
      <div id="user-name" class="small">Hi, user</div>
      <button id="signout" class="btn">Sign out</button>
    </div>
    <div id="auth-buttons" style="display:none;">
      <button id="open-auth" class="btn">Sign In / Sign Up</button>
    </div>
  </div>
</nav>

<main>
  <div id="auth-card" class="card" style="max-width:720px;margin-bottom:16px;">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <h2 style="margin:0 0 6px 0">Welcome to Smart Camtin</h2>
        <div class="small">Create an account or sign in to access the camera features.</div>
      </div>
      <div id="auth-status" class="small">Not signed in</div>
    </div>

    <div style="margin-top:14px;" id="auth-ui">
      <div class="auth-wrap">
        <div class="auth-box">
          <h3 style="margin:0 0 8px 0">Sign up (email)</h3>
          <label>Email</label>
          <input id="su-email" type="email" placeholder="you@example.com" />
          <label>Password</label>
          <input id="su-pass" type="password" placeholder="Enter password" />
          <button id="btn-signup" class="btn" style="width:100%;margin-top:8px">Create Account</button>
        </div>

        <div class="auth-box">
          <h3 style="margin:0 0 8px 0">Sign in</h3>
          <label>Email</label>
          <input id="si-email" type="email" placeholder="you@example.com" />
          <label>Password</label>
          <input id="si-pass" type="password" placeholder="Password" />
          <button id="btn-signin" class="btn" style="width:100%;margin-top:8px">Sign In</button>
          <div style="margin-top:8px">
            <button id="btn-google" class="btn secondary" style="width:100%;">Sign in with Google</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CAMERA APP -->
  <div id="app" class="card" style="display:none;">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <h2 style="margin:0">Camera</h2>
        <div class="small">Capture photos ‚Äî try our new beauty & filter presets!</div>
      </div>
      <div id="profile-info" style="text-align:right">
        <div id="profile-email" class="small"></div>
      </div>
    </div>

    <div class="camera-container">
      <video id="video" autoplay playsinline></video>
      <canvas id="canvas" width="480" height="360" hidden></canvas>

      <div id="controls">
        <button id="capture" class="btn">üì∑ Capture</button>
        <button id="flip" class="btn secondary">üîÅ Flip</button>
        <button id="toggle-beauty" class="btn">üíÑ Beauty</button>
        <a id="downloadLink" class="btn" download style="display:none;">üì• Download</a>
      </div>

      <!-- Beauty controls -->
      <div id="beauty-controls" style="display:none;margin-top:10px;width:480px;text-align:left;">
        <label>Smoothness: <input id="smooth" type="range" min="0" max="5" step="0.1" value="0"></label>
        <label>Tone: <input id="tone" type="range" min="0" max="50" value="0"></label>
        <label>Saturation: <input id="sat" type="range" min="50" max="150" value="100"></label>

        <div class="filter-buttons">
          <button class="filter-btn" data-filter="none">None</button>
          <button class="filter-btn" data-filter="warm">Warm</button>
          <button class="filter-btn" data-filter="cool">Cool</button>
          <button class="filter-btn" data-filter="vintage">Vintage</button>
          <button class="filter-btn" data-filter="bw">B&W</button>
          <button class="filter-btn" data-filter="bright">Bright</button>
        </div>

        <label style="display:block;margin-top:8px;">
          <input type="checkbox" id="auto-bright" /> Auto Brightness Correction
        </label>
      </div>
    </div>
  </div>

  <footer>
    <div class="small">¬© 2025 Smart Camtin ‚Äî Enhanced Beauty & Filters Edition</div>
  </footer>
</main>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import {
    getAuth, onAuthStateChanged, createUserWithEmailAndPassword,
    signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, signOut
  } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDwT1JTnw6rqyTaO1sbZXD624_HblKMPZM",
    authDomain: "smartcamtin-a7e07.firebaseapp.com",
    projectId: "smartcamtin-a7e07",
    appId: "1:397311969979:web:d08a7a063ba1683e16f79e"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  const authCard=document.getElementById('auth-card'),authStatus=document.getElementById('auth-status'),
  appCard=document.getElementById('app'),signoutBtn=document.getElementById('signout'),
  userArea=document.getElementById('user-area'),authButtons=document.getElementById('auth-buttons'),
  openAuthBtn=document.getElementById('open-auth'),userNameEl=document.getElementById('user-name'),
  profileEmail=document.getElementById('profile-email');

  const suEmail=document.getElementById('su-email'),suPass=document.getElementById('su-pass'),
  siEmail=document.getElementById('si-email'),siPass=document.getElementById('si-pass'),
  btnSignup=document.getElementById('btn-signup'),btnSignin=document.getElementById('btn-signin'),
  btnGoogle=document.getElementById('btn-google');

  const video=document.getElementById('video'),canvas=document.getElementById('canvas'),
  captureBtn=document.getElementById('capture'),flipBtn=document.getElementById('flip'),
  toggleBeauty=document.getElementById('toggle-beauty'),downloadLink=document.getElementById('downloadLink'),
  beautyControls=document.getElementById('beauty-controls'),
  smooth=document.getElementById('smooth'),tone=document.getElementById('tone'),
  sat=document.getElementById('sat'),autoBright=document.getElementById('auto-bright');

  const filterBtns=document.querySelectorAll('.filter-btn');
  let stream=null,isFlipped=false,beautyOn=false,currentFilter="none";

  function notifyAuth(t){authStatus.textContent=t;}

  btnSignup.onclick=async()=>{try{await createUserWithEmailAndPassword(auth,suEmail.value,suPass.value);alert("Account created!");}
  catch(e){alert("Sign up error:"+e.message)}}
  btnSignin.onclick=async()=>{try{await signInWithEmailAndPassword(auth,siEmail.value,siPass.value);alert("Signed in!");}
  catch(e){alert("Sign in error:"+e.message)}}
  btnGoogle.onclick=async()=>{try{await signInWithPopup(auth,new GoogleAuthProvider());alert("Google sign-in success!");}
  catch(e){alert("Google error:"+e.message)}}
  signoutBtn.onclick=()=>signOut(auth);

  openAuthBtn.onclick=()=>authCard.style.display=authCard.style.display==='none'?'block':'none';

  onAuthStateChanged(auth,u=>{
    if(u){notifyAuth("Signed in");authCard.style.display='none';appCard.style.display='block';userArea.style.display='flex';
      authButtons.style.display='none';userNameEl.textContent=u.displayName||u.email;profileEmail.textContent=u.email;startCamera();}
    else{notifyAuth("Not signed in");authCard.style.display='block';appCard.style.display='none';userArea.style.display='none';
      authButtons.style.display='block';stopCamera();}
  });

  async function startCamera(){
    try{if(stream)stream.getTracks().forEach(t=>t.stop());
      stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:isFlipped?'user':'environment'},audio:false});
      video.srcObject=stream;
    }catch(e){alert("Camera error:"+e.message);}
  }
  function stopCamera(){if(stream)stream.getTracks().forEach(t=>t.stop());video.srcObject=null;}

  captureBtn.onclick=()=>{
    canvas.hidden=false;
    canvas.width=video.videoWidth;canvas.height=video.videoHeight;
    const ctx=canvas.getContext('2d');ctx.filter=video.style.filter;ctx.drawImage(video,0,0,canvas.width,canvas.height);
    downloadLink.href=canvas.toDataURL('image/png');downloadLink.download=`smart-camtin-${Date.now()}.png`;
    downloadLink.style.display='inline-block';alert("Captured!");
  };
  flipBtn.onclick=()=>{isFlipped=!isFlipped;startCamera();};

  toggleBeauty.onclick=()=>{beautyOn=!beautyOn;beautyControls.style.display=beautyOn?'block':'none';applyBeauty();};

  function applyBeauty(){
    if(!beautyOn){video.style.filter='none';return;}
    const s=smooth.value,t=tone.value,sa=sat.value;
    let filter=`blur(${s}px) sepia(${t}%) saturate(${sa}%)`;
    if(autoBright.checked)filter+=` brightness(1.1) contrast(1.05)`;
    switch(currentFilter){
      case 'warm':filter+=` hue-rotate(-10deg) contrast(1.1)`;break;
      case 'cool':filter+=` hue-rotate(20deg) saturate(1.2)`;break;
      case 'vintage':filter+=` sepia(0.4) contrast(1.1)`;break;
      case 'bw':filter+=` grayscale(1) contrast(1.2)`;break;
      case 'bright':filter+=` brightness(1.3) contrast(1.15)`;break;
    }
    video.style.filter=filter;
  }

  [smooth,tone,sat,autoBright].forEach(e=>e.addEventListener('input',applyBeauty));
  filterBtns.forEach(btn=>{
    btn.onclick=()=>{
      filterBtns.forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      currentFilter=btn.dataset.filter;
      applyBeauty();
    };
  });

  document.addEventListener('DOMContentLoaded',()=>authButtons.style.display='flex');
</script>
</body>
</html>
